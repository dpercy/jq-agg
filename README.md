# jq -> agg

Goal is to translate a subset of jq query language to MongoDB queries.
It has to be correct though, which means tests.
A test should let you write some JSON and a jq query.
The expected result is generated by running it through jq.
Then you mongoimport, run the jq as an agg pipeline, and compare the results.


I have a hunch that jq is strictly more powerful than agg.
So going from agg -> jq would be easier, but less useful.
But, going in that direction could help define the spec.

Actually, one problem is that jq doesn't support reducing a stream.
You can only reduce an array; you have to use jq -s to slurp.


translating agg to jq:
- collection becomes array
- output is also an array

{ $project: { fieldA: expr, ... }} = map( { fieldA: expr, ... } )
{ $match: query } = [ .[] | select( query ) ]
{ $limit: n } = .[:n]
{ $skip: n } = .[n:]
{ $unwind: fieldref } = something like  .fieldref = .fieldref[]
  - unwind preserves all the other fields
{ $group: { \_id: <key\_expr>, <field1>: { <acc1> : <expr1> }, ... } }
... ?
group\_by(key\_expr) | reduce each array...


Find motivating examples: all agg problems from courseware.

  
